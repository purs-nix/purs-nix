# Modifying The Package Set

You can modify the `ps-pkgs/ps-pkgs-ns` output using overlays. An overlay is a function of two arguments, [traditionally called](https://nixos.org/manual/nixpkgs/stable/#sec-overlays-definition) `self` and `super` (`final`and `prev` [are also common](https://nixos.org/manual/nixpkgs/stable/#how-to-override-a-lua-package-using-overlays)). This function returns an attribute set of either packages (from the package set or built with [build](adding-packages.md#build)) or [package descriptions](adding-packages.md#package-set-git), that get merged onto the base package set. Overlays get applied in the order they are listed.

```nix
purs-nix
  { inherit system;

    overlays =
      [ (self: super:
           { string-parsers = inputs.string-parsers-old

             "my.prelude" =
                { src.git =
                    { repo = "https://github.com/me/prelude.git";
                      rev = "0000000000000000000000000000000000000000";
                    };

                  info = /package.nix;
                };
           }
        )

        inputs.my-overlay
      ];
  }
```

# Generating Overlays From Packages

So far you have only been exposed to dependencies as strings, looked up in a package set. But purs-nix actually supports derivations as dependencies as well. You can build these with the [build](adding-packages.md#build) function, or use the packages in a package set directly instead of a string. Derivation dependencies will take precedence over a package in the package set by the same name when purs-nix is figuring out the full list of dependencies needed for the project. However, this is only for *direct* dependencies of the project. If a dependency has its own derivation dependencies, they will not be used - their names will just be looked up in the package set as if they were string dependencies.

So what can you do if you also need the special derivation dependencies of one of your dependencies? For this you can use the `.overlay` property on a package. This property is generated by searching the dependency tree of a package and creating an overlay for all the derivation dependencies it requires.

```nix
purs-nix
  { inherit system;
    overlays = [ my-prelude.overlay ];
  }
```

Note: `my-prelude.overlay` does not add `my-prelude` to the package set, only its derivation dependencies. You of course can add it to the package set manually, but if you're writing library code, there is no need. You should be using `my-prelude` as a derivation dependency for your package so that it will be included in `your-package.overlay` for other people to easily use.
